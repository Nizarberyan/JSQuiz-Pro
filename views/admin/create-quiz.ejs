<%- include('../partials/header', { title: 'CrÃ©er un Quiz - JSQuiz-Pro', userId, userRole }) %>

<div class="flex-1">
    <div class="max-w-4xl mx-auto mt-10 p-6">
        <div class="bg-white rounded-lg shadow-lg p-8">
            <h2 class="text-3xl font-bold text-center text-gray-800 mb-8">CrÃ©er un nouveau Quiz</h2>
            
            <form method="POST" action="/quizzes/create-multiple" enctype="multipart/form-data" class="space-y-6">
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">ThÃ©matique</label>
                    <input type="text" name="theme" id="theme" placeholder="Entrez le thÃ¨me du quiz (ex: JavaScript, React, Node.js...)"
                           class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:border-blue-500" required>
                </div>

                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">Image du Quiz (optionnel)</label>
                    <input type="file" name="quizImage" accept="image/*"
                           class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:border-blue-500">
                </div>

                <div id="questions-container">
                    <div class="question-block border-2 border-gray-200 rounded-lg p-6 mb-6" data-question="0">
                        <div class="flex justify-between items-center mb-4">
                            <h3 class="text-lg font-semibold text-gray-800">Question 1</h3>
                            <button type="button" class="remove-question text-red-500 hover:text-red-700 hidden">
                                âœ• Supprimer
                            </button>
                        </div>
                        
                        <div class="mb-4">
                            <label class="block text-sm font-medium text-gray-700 mb-2">Question</label>
                            <textarea name="questions[0][question]" rows="3" placeholder="Entrez votre question..."
                                      class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:border-blue-500" required></textarea>
                        </div>

                        <div class="space-y-4">
                            <label class="block text-sm font-medium text-gray-700">Options de rÃ©ponse</label>
                            
                            <div class="flex items-center space-x-3">
                                <input type="checkbox" name="questions[0][correct]" value="0" class="text-green-500 answer-input" data-question="0">
                                <input type="text" name="questions[0][option1]" placeholder="Option 1" 
                                       class="flex-1 px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:border-blue-500" required>
                            </div>
                            
                            <div class="flex items-center space-x-3">
                                <input type="checkbox" name="questions[0][correct]" value="1" class="text-green-500 answer-input" data-question="0">
                                <input type="text" name="questions[0][option2]" placeholder="Option 2" 
                                       class="flex-1 px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:border-blue-500" required>
                            </div>
                            
                            <div class="flex items-center space-x-3">
                                <input type="checkbox" name="questions[0][correct]" value="2" class="text-green-500 answer-input" data-question="0">
                                <input type="text" name="questions[0][option3]" placeholder="Option 3" 
                                       class="flex-1 px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:border-blue-500" required>
                            </div>
                            
                            <div class="flex items-center space-x-3">
                                <input type="checkbox" name="questions[0][correct]" value="3" class="text-green-500 answer-input" data-question="0">
                                <input type="text" name="questions[0][option4]" placeholder="Option 4" 
                                       class="flex-1 px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:border-blue-500" required>
                            </div>
                        </div>

                        <div class="text-sm text-gray-600 mt-4">
                            <p>ðŸ’¡ SÃ©lectionnez une ou plusieurs bonnes rÃ©ponses</p>
                        </div>
                    </div>
                </div>

                <div class="flex justify-center mb-6">
                    <button type="button" id="add-question" class="bg-green-500 hover:bg-green-600 text-white py-2 px-4 rounded-lg font-medium">
                        âž• Ajouter une question
                    </button>
                </div>

                <div class="flex space-x-4 pt-6">
                    <button type="submit" class="flex-1 bg-blue-500 hover:bg-blue-600 text-white py-3 px-6 rounded-lg font-medium">
                        CrÃ©er le Quiz
                    </button>
                    <button type="button" class="flex-1 bg-gray-500 hover:bg-gray-600 text-white py-3 px-6 rounded-lg font-medium" onclick="window.location.href='/quizzes'">
                        Annuler
                    </button>
                </div>
            </form>
        </div>
    </div>
</div>

<script>
let questionCount = 1;

document.getElementById('add-question').addEventListener('click', function() {
    const container = document.getElementById('questions-container');
    const newQuestion = document.createElement('div');
    newQuestion.className = 'question-block border-2 border-gray-200 rounded-lg p-6 mb-6';
    newQuestion.setAttribute('data-question', questionCount);
    
    newQuestion.innerHTML = `
        <div class="flex justify-between items-center mb-4">
            <h3 class="text-lg font-semibold text-gray-800">Question ${questionCount + 1}</h3>
            <button type="button" class="remove-question text-red-500 hover:text-red-700">
                âœ• Supprimer
            </button>
        </div>
        
        <div class="mb-4">
            <label class="block text-sm font-medium text-gray-700 mb-2">Question</label>
            <textarea name="questions[${questionCount}][question]" rows="3" placeholder="Entrez votre question..."
                      class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:border-blue-500" required></textarea>
        </div>

        <div class="space-y-4">
            <label class="block text-sm font-medium text-gray-700">Options de rÃ©ponse</label>
            
            <div class="flex items-center space-x-3">
                <input type="checkbox" name="questions[${questionCount}][correct]" value="0" class="text-green-500 answer-input" data-question="${questionCount}">
                <input type="text" name="questions[${questionCount}][option1]" placeholder="Option 1" 
                       class="flex-1 px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:border-blue-500" required>
            </div>
            
            <div class="flex items-center space-x-3">
                <input type="checkbox" name="questions[${questionCount}][correct]" value="1" class="text-green-500 answer-input" data-question="${questionCount}">
                <input type="text" name="questions[${questionCount}][option2]" placeholder="Option 2" 
                       class="flex-1 px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:border-blue-500" required>
            </div>
            
            <div class="flex items-center space-x-3">
                <input type="checkbox" name="questions[${questionCount}][correct]" value="2" class="text-green-500 answer-input" data-question="${questionCount}">
                <input type="text" name="questions[${questionCount}][option3]" placeholder="Option 3" 
                       class="flex-1 px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:border-blue-500" required>
            </div>
            
            <div class="flex items-center space-x-3">
                <input type="checkbox" name="questions[${questionCount}][correct]" value="3" class="text-green-500 answer-input" data-question="${questionCount}">
                <input type="text" name="questions[${questionCount}][option4]" placeholder="Option 4" 
                       class="flex-1 px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:border-blue-500" required>
            </div>
        </div>

        <div class="text-sm text-gray-600 mt-4">
            <p>ðŸ’¡ SÃ©lectionnez une ou plusieurs bonnes rÃ©ponses</p>
        </div>
    `;
    
    container.appendChild(newQuestion);
    questionCount++;
    updateRemoveButtons();
});

document.addEventListener('click', function(e) {
    if (e.target.classList.contains('remove-question')) {
        e.target.closest('.question-block').remove();
        updateRemoveButtons();
        updateQuestionNumbers();
    }
});

function updateRemoveButtons() {
    const questions = document.querySelectorAll('.question-block');
    questions.forEach((question, index) => {
        const removeBtn = question.querySelector('.remove-question');
        if (questions.length > 1) {
            removeBtn.classList.remove('hidden');
        } else {
            removeBtn.classList.add('hidden');
        }
    });
}

function updateQuestionNumbers() {
    const questions = document.querySelectorAll('.question-block');
    questions.forEach((question, index) => {
        question.querySelector('h3').textContent = `Question ${index + 1}`;
    });
}

document.querySelector('form').addEventListener('submit', function(e) {
    const questions = document.querySelectorAll('.question-block');
    questions.forEach((block, index) => {
        const checked = block.querySelectorAll('input[name="questions[' + index + '][correct]"]:checked');
        if (checked.length === 0) {
            e.preventDefault();
            alert('Please select at least one correct answer for Question ' + (index + 1));
            return false;
        }
    });
});
</script>

<%- include('../partials/footer') %>